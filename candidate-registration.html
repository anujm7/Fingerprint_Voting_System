<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Candidate Registration | Online Voting System</title>
<style>
  :root{
    --navy:#101a3a;
    --navy-2:#182447;
    --red:#e23b3b;
    --grey:#6b7280;
    --light:#f8fafc;
    --card:#ffffff;
    --shadow:0 10px 24px rgba(0,0,0,.15);
    --success:#10b981;
    --warning:#f59e0b;
    --danger:#ef4444;
    --border:#e5e7eb;
  }
  
  *{margin:0;padding:0;box-sizing:border-box}
  body{
    font-family: "Segoe UI", Tahoma, sans-serif;
    color:#111827;background:var(--light);line-height:1.55;
    min-height:100vh;
  }

  /* Header */
  .header{
    background:linear-gradient(135deg, var(--navy), var(--navy-2));
    color:#fff;padding:20px 0;box-shadow:var(--shadow);
  }
  .header-content{
    max-width:1200px;margin:0 auto;padding:0 20px;
    display:flex;justify-content:space-between;align-items:center;
  }
  .brand{display:flex;align-items:center;gap:15px}
  .brand .logo{font-size:40px}
  .brand .title{font-size:28px;font-weight:800}
  .brand .sub{font-size:16px;opacity:.8;margin-top:4px}
  
  .nav-links{display:flex;gap:20px}
  .nav-link{color:#fff;text-decoration:none;padding:8px 16px;border-radius:20px;transition:all .2s}
  .nav-link:hover{background:rgba(255,255,255,.2)}

  /* Main Container */
  .container{
    max-width:800px;margin:40px auto;padding:0 20px;
  }

  /* Registration Form */
  .registration-card{
    background:#fff;border-radius:16px;box-shadow:var(--shadow);
    overflow:hidden;margin-bottom:30px;
  }
  
  .card-header{
    background:linear-gradient(135deg, var(--navy), var(--navy-2));
    color:#fff;padding:30px;text-align:center;
  }
  .card-header h1{font-size:32px;font-weight:800;margin-bottom:8px}
  .card-header p{font-size:16px;opacity:.9}

  .card-body{padding:40px}

  /* Form Styles */
  .form-section{margin-bottom:35px}
  .section-title{
    font-size:20px;font-weight:700;color:var(--navy);
    margin-bottom:20px;padding-bottom:10px;
    border-bottom:2px solid var(--border);
    display:flex;align-items:center;gap:10px;
  }

  .form-row{
    display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;
  }
  .form-row.single{grid-template-columns:1fr}

  .form-group{margin-bottom:20px}
  .form-label{
    display:block;margin-bottom:8px;font-weight:600;color:var(--navy);
    font-size:14px;
  }
  .form-input, .form-select, .form-textarea{
    width:100%;padding:14px;border:2px solid var(--border);border-radius:8px;
    font-size:16px;transition:all .2s ease;background:#fff;
  }
  .form-input:focus, .form-select:focus, .form-textarea:focus{
    outline:none;border-color:var(--red);box-shadow:0 0 0 3px rgba(226,59,59,.1);
  }
  .form-textarea{resize:vertical;min-height:100px}

  .form-help{font-size:12px;color:var(--grey);margin-top:4px}

  /* File Upload */
  .file-upload{
    border:2px dashed var(--border);border-radius:8px;padding:30px;
    text-align:center;background:var(--light);transition:all .2s;
    cursor:pointer;position:relative;
  }
  .file-upload:hover{border-color:var(--red);background:#fef2f2}
  .file-upload.dragover{border-color:var(--red);background:#fef2f2}
  
  .file-upload input{position:absolute;opacity:0;width:100%;height:100%;cursor:pointer}
  .file-upload-icon{font-size:48px;color:var(--grey);margin-bottom:10px}
  .file-upload-text{color:var(--grey);font-size:16px}
  .file-preview{margin-top:15px;text-align:left}
  .file-preview img{max-width:150px;max-height:150px;border-radius:8px;box-shadow:var(--shadow)}

  /* Submit Button */
  .submit-section{text-align:center;padding-top:20px}
  .btn-submit{
    background:linear-gradient(135deg, var(--red), #d33);
    color:#fff;border:none;padding:16px 40px;border-radius:25px;
    font-size:18px;font-weight:700;cursor:pointer;
    transition:all .3s ease;box-shadow:var(--shadow);
    min-width:200px;
  }
  .btn-submit:hover{transform:translateY(-2px);box-shadow:0 15px 30px rgba(226,59,59,.3)}
  .btn-submit:disabled{background:#ccc;cursor:not-allowed;transform:none}

  /* Status Messages */
  .status-message{
    padding:15px;border-radius:8px;margin-bottom:20px;
    display:none;font-weight:600;
  }
  .status-success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
  .status-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
  .status-loading{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb}

  /* Responsive */
  @media (max-width: 768px) {
    .header-content{flex-direction:column;gap:15px;text-align:center}
    .form-row{grid-template-columns:1fr}
    .card-body{padding:25px}
  }

  /* Loading Animation */
  .loading-spinner{
    display:inline-block;width:20px;height:20px;
    border:3px solid rgba(255,255,255,.3);
    border-radius:50%;border-top-color:#fff;
    animation:spin 1s ease-in-out infinite;
    margin-right:10px;
  }
  @keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="brand">
        <div class="logo">üèõÔ∏è</div>
        <div>
          <div class="title">Candidate Registration</div>
          <div class="sub">Register to run for election</div>
        </div>
      </div>
      <div class="nav-links">
        <a href="main.html" class="nav-link">üè† Home</a>
        <a href="login.html" class="nav-link">üë§ Login</a>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- Status Messages -->
    <div id="status-message" class="status-message"></div>

    <!-- Registration Form -->
    <div class="registration-card">
      <div class="card-header">
        <h1>üèõÔ∏è Candidate Registration</h1>
        <p>Complete the form below to register as a candidate for upcoming elections</p>
      </div>

      <div class="card-body">
        <form id="candidate-form">
          <!-- Personal Information -->
          <div class="form-section">
            <h3 class="section-title">
              üë§ Personal Information
            </h3>
            
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">First Name *</label>
                <input type="text" name="firstName" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">Last Name *</label>
                <input type="text" name="lastName" class="form-input" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Date of Birth *</label>
                <input type="date" name="dateOfBirth" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">Gender *</label>
                <select name="gender" class="form-select" required>
                  <option value="">Select Gender</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Email Address *</label>
                <input type="email" name="email" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">Phone Number *</label>
                <input type="tel" name="phone" class="form-input" required>
              </div>
            </div>
          </div>

          <!-- Address Information -->
          <div class="form-section">
            <h3 class="section-title">
              üìç Address Information
            </h3>
            
            <div class="form-row single">
              <div class="form-group">
                <label class="form-label">Street Address *</label>
                <input type="text" name="address" class="form-input" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">City *</label>
                <input type="text" name="city" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label">State *</label>
                <select name="state" class="form-select" required>
                  <option value="">Select State</option>
                  <option value="Andhra Pradesh">Andhra Pradesh</option>
                  <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                  <option value="Assam">Assam</option>
                  <option value="Bihar">Bihar</option>
                  <option value="Chhattisgarh">Chhattisgarh</option>
                  <option value="Goa">Goa</option>
                  <option value="Gujarat">Gujarat</option>
                  <option value="Haryana">Haryana</option>
                  <option value="Himachal Pradesh">Himachal Pradesh</option>
                  <option value="Jharkhand">Jharkhand</option>
                  <option value="Karnataka">Karnataka</option>
                  <option value="Kerala">Kerala</option>
                  <option value="Maharashtra">Maharashtra</option>
                  <option value="Manipur">Manipur</option>
                  <option value="Meghalaya">Meghalaya</option>
                  <option value="Mizoram">Mizoram</option>
                  <option value="Nagaland">Nagaland</option>
                  <option value="Odisha">Odisha</option>
                  <option value="Punjab">Punjab</option>
                  <option value="Rajasthan">Rajasthan</option>
                  <option value="Sikkim">Sikkim</option>
                  <option value="Tamil Nadu">Tamil Nadu</option>
                  <option value="Telangana">Telangana</option>
                  <option value="Tripura">Tripura</option>
                  <option value="Uttar Pradesh">Uttar Pradesh</option>
                  <option value="Uttarakhand">Uttarakhand</option>
                  <option value="West Bengal">West Bengal</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Pin Code *</label>
                <input type="text" name="pinCode" class="form-input" required pattern="[0-9]{6}">
              </div>
              <div class="form-group">
                <label class="form-label">Constituency *</label>
                <input type="text" name="constituency" class="form-input" required>
                <div class="form-help">Enter the constituency you wish to contest from</div>
              </div>
            </div>
          </div>

          <!-- Political Information -->
          <div class="form-section">
            <h3 class="section-title">
              üèõÔ∏è Political Information
            </h3>
            
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Political Party *</label>
                <select name="politicalParty" class="form-select" required>
                  <option value="">Select Party</option>
                  <option value="Independent">Independent</option>
                  <option value="BJP">Bharatiya Janata Party (BJP)</option>
                  <option value="INC">Indian National Congress (INC)</option>
                  <option value="AAP">Aam Aadmi Party (AAP)</option>
                  <option value="BSP">Bahujan Samaj Party (BSP)</option>
                  <option value="SP">Samajwadi Party (SP)</option>
                  <option value="TMC">All India Trinamool Congress (TMC)</option>
                  <option value="DMK">Dravida Munnetra Kazhagam (DMK)</option>
                  <option value="AIADMK">All India Anna Dravida Munnetra Kazhagam (AIADMK)</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Symbol *</label>
                <input type="text" name="symbol" class="form-input" required>
                <div class="form-help">Election symbol for your candidacy</div>
              </div>
            </div>

            <div class="form-row single">
              <div class="form-group">
                <label class="form-label">Campaign Slogan</label>
                <input type="text" name="slogan" class="form-input" placeholder="Your campaign slogan (optional)">
              </div>
            </div>

            <div class="form-row single">
              <div class="form-group">
                <label class="form-label">Manifesto/Platform *</label>
                <textarea name="manifesto" class="form-textarea" required 
                          placeholder="Describe your political platform, key issues, and what you stand for..."></textarea>
              </div>
            </div>
          </div>

          <!-- Education & Experience -->
          <div class="form-section">
            <h3 class="section-title">
              üéì Education & Experience
            </h3>
            
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Education Level *</label>
                <select name="education" class="form-select" required>
                  <option value="">Select Education Level</option>
                  <option value="High School">High School</option>
                  <option value="Graduate">Graduate</option>
                  <option value="Post Graduate">Post Graduate</option>
                  <option value="Doctorate">Doctorate</option>
                  <option value="Professional">Professional Degree</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Profession</label>
                <input type="text" name="profession" class="form-input" placeholder="Current profession/occupation">
              </div>
            </div>

            <div class="form-row single">
              <div class="form-group">
                <label class="form-label">Previous Political Experience</label>
                <textarea name="experience" class="form-textarea" 
                          placeholder="Describe any previous political roles, community service, or relevant experience..."></textarea>
              </div>
            </div>
          </div>

          <!-- Photo Upload -->
          <div class="form-section">
            <h3 class="section-title">
              üì∏ Candidate Photo
            </h3>
            
            <div class="form-group">
              <div class="file-upload" onclick="document.getElementById('photo').click()">
                <input type="file" id="photo" name="photo" accept="image/*">
                <div class="file-upload-icon">üì∏</div>
                <div class="file-upload-text">
                  Click to upload candidate photo<br>
                  <small>JPG, PNG up to 5MB</small>
                </div>
                <div id="photo-preview" class="file-preview"></div>
              </div>
            </div>
          </div>

          <!-- Submit Section -->
          <div class="submit-section">
            <button type="submit" class="btn-submit" id="submit-btn">
              üìù Register as Candidate
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Firebase Integration -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBUq8kXNMY29rfqEf0APbnyDMf-fWTc7SU",
      authDomain: "fingerprint-voting-syste-d926c.firebaseapp.com",
      databaseURL: "https://fingerprint-voting-syste-d926c-default-rtdb.firebaseio.com",
      projectId: "fingerprint-voting-syste-d926c",
      storageBucket: "fingerprint-voting-syste-d926c.firebasestorage.app",
      messagingSenderId: "458706704567",
      appId: "1:458706704567:web:e1595ac2701de926219532",
      measurementId: "G-4SEHLRDTCY"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Make available globally
    window.database = database;
    window.firebaseRefs = { ref, push, set };
  </script>

  <script>
    // Form handling
    const form = document.getElementById('candidate-form');
    const submitBtn = document.getElementById('submit-btn');
    const statusMessage = document.getElementById('status-message');

    // Photo preview
    document.getElementById('photo').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const preview = document.getElementById('photo-preview');
      
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
        };
        reader.readAsDataURL(file);
      } else {
        preview.innerHTML = '';
      }
    });

    // Show status message
    function showStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = `status-message status-${type}`;
      statusMessage.style.display = 'block';
      
      // Auto hide after 5 seconds for success messages
      if (type === 'success') {
        setTimeout(() => {
          statusMessage.style.display = 'none';
        }, 5000);
      }
    }

    // Generate candidate ID
    function generateCandidateId() {
      const prefix = 'CAND';
      const timestamp = Date.now().toString().slice(-6);
      const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
      return `${prefix}${timestamp}${random}`;
    }

    // Calculate age
    function calculateAge(birthDate) {
      const today = new Date();
      const birth = new Date(birthDate);
      let age = today.getFullYear() - birth.getFullYear();
      const monthDiff = today.getMonth() - birth.getMonth();
      
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--;
      }
      
      return age;
    }

    // Form submission
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Validate age (minimum 25 for most elections)
      const dateOfBirth = form.dateOfBirth.value;
      const age = calculateAge(dateOfBirth);
      
      if (age < 25) {
        showStatus('Candidate must be at least 25 years old to register.', 'error');
        return;
      }
      
      // Show loading state
      submitBtn.innerHTML = '<span class="loading-spinner"></span>Registering...';
      submitBtn.disabled = true;
      showStatus('Registering candidate, please wait...', 'loading');
      
      try {
        // Collect form data
        const formData = new FormData(form);
        const candidateData = {};
        
        // Convert FormData to object
        for (let [key, value] of formData.entries()) {
          if (key !== 'photo') {
            candidateData[key] = value;
          }
        }
        
        // Add additional data
        candidateData.candidateId = generateCandidateId();
        candidateData.age = age;
        candidateData.registrationDate = new Date().toISOString();
        candidateData.status = 'Pending'; // Pending, Approved, Rejected
        candidateData.votes = 0;
        candidateData.verified = false;
        
        // Handle photo upload (for now, we'll store as base64 - in production use Firebase Storage)
        const photoFile = document.getElementById('photo').files[0];
        if (photoFile) {
          const reader = new FileReader();
          reader.onload = async function(e) {
            candidateData.photoBase64 = e.target.result;
            await saveCandidateData(candidateData);
          };
          reader.readAsDataURL(photoFile);
        } else {
          candidateData.photoBase64 = null;
          await saveCandidateData(candidateData);
        }
        
      } catch (error) {
        console.error('Registration error:', error);
        showStatus('Registration failed. Please try again.', 'error');
        
        // Reset button
        submitBtn.innerHTML = 'üìù Register as Candidate';
        submitBtn.disabled = false;
      }
    });

    // Save candidate data to Firebase
    async function saveCandidateData(candidateData) {
      try {
        const candidatesRef = window.firebaseRefs.ref(window.database, 'candidates');
        const newCandidateRef = window.firebaseRefs.push(candidatesRef);
        
        await window.firebaseRefs.set(newCandidateRef, candidateData);
        
        // Success
        showStatus(
          `Registration successful! Your Candidate ID is: ${candidateData.candidateId}. Please save this for future reference.`, 
          'success'
        );
        
        // Reset form
        form.reset();
        document.getElementById('photo-preview').innerHTML = '';
        
        // Reset button
        submitBtn.innerHTML = 'üìù Register as Candidate';
        submitBtn.disabled = false;
        
        // Optional: Redirect to success page or login
        setTimeout(() => {
          if (confirm('Registration completed! Would you like to go to the login page?')) {
            window.location.href = 'login.html';
          }
        }, 3000);
        
      } catch (error) {
        console.error('Error saving candidate data:', error);
        showStatus('Error saving data. Please try again.', 'error');
        
        // Reset button
        submitBtn.innerHTML = 'üìù Register as Candidate';
        submitBtn.disabled = false;
      }
    }

    // Form validation
    form.addEventListener('input', function(e) {
      const field = e.target;
      
      // Pin code validation
      if (field.name === 'pinCode') {
        field.value = field.value.replace(/\D/g, '').slice(0, 6);
      }
      
      // Phone validation
      if (field.name === 'phone') {
        field.value = field.value.replace(/\D/g, '').slice(0, 10);
      }
      
      // Name validation (only letters and spaces)
      if (field.name === 'firstName' || field.name === 'lastName') {
        field.value = field.value.replace(/[^a-zA-Z\s]/g, '');
      }
    });

    // Drag and drop for photo upload
    const fileUpload = document.querySelector('.file-upload');
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      fileUpload.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
      fileUpload.addEventListener(eventName, () => fileUpload.classList.add('dragover'), false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
      fileUpload.addEventListener(eventName, () => fileUpload.classList.remove('dragover'), false);
    });
    
    fileUpload.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        document.getElementById('photo').files = files;
        document.getElementById('photo').dispatchEvent(new Event('change', { bubbles: true }));
      }
    }
  </script>

</body>
</html>